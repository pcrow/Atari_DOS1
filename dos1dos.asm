CASINI	= $0002
DOSVEC	= $000A
POKMSK	= $0010
BRKKEY	= $0011
RAMLO	= $001A
JMPTBL	= $001B
ICHIDZ	= $0020
ICDNOZ	= $0021
ICBALZ	= $0024
ICBAHZ	= $0025
ICIDNO	= $002E
ZBUFP	= $0043
ZSBA	= $0047
ERRNO	= $0049
L008D	= $008D
MEMTOP	= $02E5
MEMLO	= $02E7
DUNIT	= $0301
DCBCMD	= $0302
DSTATS	= $0303
DBUFLO	= $0304
DBUFHI	= $0305
DCBSEC	= $030A
L031A	= $031A
L031B	= $031B
L031C	= $031C
IOCB	= $0340
ICDNO	= $0341
ICCOM	= $0342
ICSTA	= $0343
ICBAL	= $0344
ICBAH	= $0345
ICBLL	= $0348
ICBLH	= $0349
ICAX1	= $034A
ICAX2	= $034B
L04A0	= $04A0
DOS	= $1300
L2011	= $2011
L4C11	= $4C11
L8C0E	= $8C0E
LA511	= $A511
IRGEN	= $D20E
DKHND	= $E453
CIO	= $E456
SETVBV	= $E45C
SYSVBV	= $E45F
XITVBV	= $E462
	*= $0700
BFLG	.byte	$00
BRCNT	.byte	$01
BLDADR	.word	BFLG
BINTADR	.word	DOS
BCONT	JMP	XBCONT
SABYTE	.byte	$03
DRVBYT	.byte	$0F
SAFBFW	.byte	$00
SASA	.word	$2680
DFSFLG	.byte	$FF
	.byte	$00
DFLINK	.word	CASINI
XBCONT	LDA	DFSFLG
	BEQ	BFAIL
	LDA	#$07
	STA	ZBUFP+1
	LDA	#$03
	STA	ZBUFP
	JSR	INCBA
	LDA	DFLINK+1
	LDY	DFLINK
XBC1	CLC
	JSR	BSIO
	BMI	BFAIL
	LDY	#$7F
	LDA	(ZBUFP),Y
	BMI	BGOOD
	LDY	#$7D
	LDA	(ZBUFP),Y
	AND	#$03
	PHA
	INY
	LDA	(ZBUFP),Y
	TAY
	JSR	INCBA
	PLA
	JMP	XBC1
BFAIL	LDA	#$C0
	BNE	XBRTN
BGOOD	LDA	#$00
XBRTN	ASL	A
	TAY
	RTS
INCBA	CLC
	LDA	ZBUFP
	ADC	#$7D
	STA	DBUFLO
	STA	ZBUFP
	LDA	ZBUFP+1
	ADC	#$00
	STA	DBUFHI
	STA	ZBUFP+1
	RTS
BSIO	STA	DCBSEC+1
	STY	DCBSEC
	LDA	#$52
	BCC	DSIO1
	LDA	#$57
DSIO1	STA	DCBCMD
L0772	JSR	DKHND
	LDX	CURFCB
	LDA	DSTATS
	RTS
DFMSDH	.word	DFMOPN-1
	.word	DFMCLS-1
	.word	DFMGET-1
	.word	DFMPUT-1
	.word	DFMSTA-1
	.word	DFMDDC-1
L0788	LDA	#$FF
	LDY	#$10
L078C	STA	DRVTBL,Y
	DEY
	BPL	L078C
	LDA	#$00
	STA	L1157
	LDA	DRVBYT
	LDX	#$07
L079C	ROL	A
	BCC	L07B4
	PHA
	LDA	L1157
	INC	L1157
	STA	DRVTBL,X
	TAY
	JSR	L0FB5
	LDY	#$05
	LDA	#$00
	STA	(ZBUFP+1),Y
	PLA
L07B4	DEX
	BPL	L079C
	LDA	#$00
	LDY	SABYTE
	DEY
L07BD	STA	SECTBL,Y
	DEY
	BPL	L07BD
	INY
L07C4	STA	FCBFNO,Y
	INY
	BNE	L07C4
	LDY	#$00
L07CC	LDA	L031A,Y
	BEQ	L07DD
	CMP	#$44
	BEQ	L07DD
	INY
	INY
	INY
	CPY	#$1E
	BNE	L07CC
	BRK
L07DD	LDA	#$44
	STA	L031A,Y
	LDA	#$7C
	STA	L031B,Y
	LDA	#$07
	STA	L031C,Y
	LDA	L1157
	LDY	SABYTE
	INY
	JSR	L0FD4
	STA	$02E8
	STY	MEMLO
	RTS
DFMOPN	JSR	SETUP
	JSR	L103B
	JSR	FNDCODE
	LDA	ICAX1,X
	STA	FCBOTC,X
	AND	#$02
	BEQ	OPN1
	JMP	LISTDIR
OPN1	JSR	SFDIR
	BCC	L0888
	LDA	FCBOTC,X
	EOR	#$08
	BNE	L0882
	LDA	L1123
	BMI	L0885
	STA	CDIRS
	JSR	L0E9D
	LDA	L1124
	STA	CDIRD
	LDA	L1125
	STA	L1128
	JSR	RDVTOC
L0839	JSR	GETSECTOR
	LDY	CDIRD
	STA	FILDIR+4,Y
	LDA	FCBLSN,X
	STA	FILDIR+3,Y
	STA	FILDIR+1,Y
	LDA	#$40
	STA	FILDIR,Y
	LDA	#$00
	STA	FILDIR+1,Y
	LDX	#$00
L0857	LDA	FNAME,X
	CMP	#$3F
	BNE	L0860
	LDA	#$20
L0860	STA	S_DOSSYS3,Y
	INY
	INX
	CPX	#$0B
	BCC	L0857
	LDX	CURFCB
	JSR	WRTDIR
	JSR	L08EF
	JSR	L0E19
	LDA	#$80
	STA	FCBFLG,X
	JSR	TSTDOS
	BNE	L08EC
	JMP	WRTDOS
L0882	JSR	ERFNF
L0885	JSR	ERDFULL
L0888	JSR	L08EF
	LDY	CDIRD
	LDA	FILDIR+3,Y
	STA	FCBLSN,X
	LDA	FILDIR+4,Y
	STA	FCBLSN+1,X
	JSR	L0E5A
	LDA	FCBOTC,X
	EOR	#$04
	BEQ	L08EC
	JSR	TSTLOCK
	LDA	FCBOTC,X
	AND	#$04
	BNE	L08EC
	JSR	RDVTOC
	LDA	#$80
	STA	FCBFLG,X
	LDA	FCBOTC,X
	AND	#$01
	BEQ	L08E1
	LDY	CDIRD
	LDA	FILDIR+2,Y
	STA	FCBCNT+1,X
	LDA	FILDIR+1,Y
	STA	FCBCNT,X
	BNE	L08D1
	DEC	FCBCNT+1,X
L08D1	DEC	FCBCNT
L08D4	JSR	RDNXTS
	BCC	L08D4
	LDA	FCBMLN,X
	STA	FCBDLN,X
	BCS	L08EC
L08E1	JSR	L0EED
	JSR	RDNXTS
	BCC	L08E1
	JMP	L0839
L08EC	JMP	GREAT
L08EF	LDA	#$00
	STA	FCBFLG,X
	LDA	L1128
	ASL	A
	ASL	A
	STA	FCBFNO,X
	LDA	#$00
	STA	FCBDLN,X
	STA	FCBSSN,X
	STA	FCBSSN+1,X
	STA	FCBCNT,X
	STA	FCBCNT+1,X
	RTS
DFMPUT	STA	SVDBYT
	LDA	ICDNO,X
	STA	ICDNOZ
	JSR	SETUP
	LDY	FCBDLN,X
	CPY	#$7D
	BCC	L0929
	JSR	WRTNXS
	LDA	#$00
	STA	FCBDLN,X
	TAY
L0929	INC	FCBDLN,X
	LDA	SVDBYT
	STA	(ZSBA),Y
	LDA	#$40
	ORA	FCBFLG,X
	STA	FCBFLG,X
	JMP	GREAT
DFMGET	JSR	SETUP
	LDA	FCBOTC,X
	AND	#$02
	BEQ	GET1
	JMP	GDCHAR
GET1	LDA	FCBDLN,X
	CMP	FCBMLN,X
	BCC	GET2
	JSR	RDNXTS
	BCC	GET1
	JMP	ERREOF
GET2	TAY
	LDA	(ZSBA),Y
	STA	SVDBYT
	INY
	TYA
	STA	FCBDLN,X
	LDY	FCBLSN,X
	BNE	L0978
	LDY	FCBLSN+1,X
	BNE	L0978
	CMP	FCBMLN,X
	BCC	L0978
	LDA	#$03
	JMP	RETURN
L0978	JMP	GREAT
DFMSTA	JSR	SETUP
	JSR	FNDCODE
	JSR	SFDIR
	BCS	SFNF
	JSR	TSTLOCK
	JMP	GREAT
SFNF	JMP	ERFNF
DFMCLS	JSR	SETUP
	LDA	FCBOTC,X
	AND	#$09
	BEQ	CLDONE
	ROL	FCBFLG,X
	BCC	CLUPDT
	LDA	FCBDLN,X
	ORA	#$80
	JSR	L0DA6
	JSR	L09C3
CLDONE	LDA	#$00
	STA	FCBOTC,X
	JMP	FGREAT
FNSHFT	LDA	#$00
FNSHF1	LDY	#$03
FNSHF2	ASL	FCBFNO,X
	ROL	A
	DEY
	BNE	FNSHF2
	RTS
CLUPDT	JSR	WRTNXS
	JMP	CLDONE
L09C3	JSR	FNSHFT
	STA	CDIRS
	JSR	FNSHFT
	JSR	FNSHF1
	ASL	A
	STA	CDIRD
	JSR	L0E9D
	LDY	CDIRD
	LDA	FCBCNT+1,X
	STA	FILDIR+2,Y
	LDA	FCBCNT,X
	STA	FILDIR+1,Y
	JSR	WRTDIR
	JMP	WRTVTOC
DFMDDC	JSR	SETUP
	LDA	ICCOM,X
	CMP	#$FE
	BEQ	XFV
	CMP	#$27
	BCS	DVDCER
	SEC
	SBC	#$20
	BCC	DVDCER
	ASL	A
	TAY
	LDA	DVDCVT,Y
	PHA
	LDA	DVDCVT+1,Y
	PHA
	RTS
DVDCVT	.dbyte	XRENAME-1
	.dbyte	XDELETE-1
	.dbyte	DVDCER-1
	.dbyte	XLOCK-1
	.dbyte	XUNLOCK-1
	.dbyte	XPOINT-1
	.dbyte	XNOTE-1
DVDCER	JMP	ERDVDC
XFV	JMP	XFORMAT
XRENAME	JSR	FNDCODE
	STY	TEMP2
	JSR	SFDIR
	BCC	XRN1
	JMP	ERFNF
XRN1	JSR	TSTLOCK
	JSR	TSTDOS
	BNE	XRN1A
	JSR	DELDOS
XRN1A	LDY	TEMP2
	JSR	FNDCNX
	JSR	TSTDOS
	BNE	XRN1B
	LDY	CDIRD
	LDA	FILDIR+4,Y
	PHA
	LDA	FILDIR+3,Y
	TAY
	PLA
	JSR	SETDSO
XRN1B	LDX	#$00
	LDY	CDIRD
XRN2	LDA	FNAME,X
	CMP	#$3F
	BEQ	XRN3
	STA	S_DOSSYS3,Y
XRN3	INY
	INX
	CPX	#$0B
	BCC	XRN2
	LDX	CURFCB
	JSR	WRTDIR
	JSR	FNDCODE
	JSR	CFSDIR
	BCC	XRN1
	JMP	FGREAT
XDELETE	JSR	FNDCODE
	JSR	SFDIR
	BCC	L0A81
	JMP	ERFNF
L0A81	JSR	RDVTOC
L0A84	LDY	CDIRD
	JSR	TSTLOCK
	LDA	#$80
	STA	FILDIR,Y
	LDA	FILDIR+3,Y
	STA	FCBLSN,X
	LDA	FILDIR+4,Y
	STA	FCBLSN+1,X
	JSR	L08EF
	JSR	L0E5A
	JMP	L0AA9
L0AA4	JSR	RDNXTS
	BCS	L0AAF
L0AA9	JSR	L0EED
	JMP	L0AA4
L0AAF	JSR	WRTDIR
	JSR	CFSDIR
	BCC	L0A84
	JSR	WRTVTOC
	JSR	TSTDOS
	BNE	L0AC2
	JSR	DELDOS
L0AC2	JMP	FGREAT
XLOCK	LDA	#$20
	STA	TEMP4
	BNE	XLCOM
XUNLOCK	LDA	#$00
	STA	TEMP4
XLCOM	JSR	FNDCODE
	JSR	SFDIR
	BCC	XLC1
	JMP	ERFNF
XLC1	LDY	CDIRD
	LDA	FILDIR,Y
	AND	#$DF
	ORA	TEMP4
	STA	FILDIR,Y
	JSR	WRTDIR
	JSR	CFSDIR
	BCC	XLC1
	JMP	FGREAT
TSTLOCK	LDY	CDIRD
	LDA	FILDIR,Y
	AND	#$20
	BNE	TLF
	RTS
TLF	JMP	ERFLOCK
XPOINT	LDA	FCBFLG,X
	BMI	PERR1
	LDA	IOCB0+1,X
	CMP	FCBCSN+1,X
	BNE	XP1
	LDA	$034C,X
	CMP	FCBCSN,X
	BEQ	XP2
XP1	JSR	WRTNXS
	LDA	IOCB0+1,X
	STA	FCBLSN+1,X
	LDA	$034C,X
	STA	FCBLSN,X
	JSR	L0E5A
XP2	LDA	IOCB0+1,X
	CMP	FCBMLN,X
	BCC	L0B37
	BEQ	L0B37
	JMP	ERRPDL
L0B37	STA	FCBDLN,X
	JMP	GREAT
PERR1	JMP	ERRPOT
XNOTE	LDA	FCBDLN,X
	STA	IOCB0+1,X
	LDA	FCBCSN,X
	STA	$034C,X
	LDA	FCBCSN+1,X
	STA	IOCB0+1,X
	JMP	GREAT
XFORMAT	LDA	$46
	STA	DBUFHI
	LDA	ZBUFP+1
	STA	DBUFLO
	LDA	#$21
	JSR	DSIO1
	LDA	#$00
	TAY
L0B67	STA	(ZBUFP+1),Y
	INY
	BPL	L0B67
	LDY	#$00
	LDA	#$01
	STA	(ZBUFP+1),Y
	INY
	LDA	#$C5
	STA	(ZBUFP+1),Y
	INY
	INY
	STA	(ZBUFP+1),Y
	LDA	#$02
	DEY
	STA	(ZBUFP+1),Y
	INY
	INY
	STA	(ZBUFP+1),Y
	LDY	#$0A
	LDA	#$FF
L0B88	STA	(ZBUFP+1),Y
	INY
	CPY	#$64
	BNE	L0B88
	LDA	#$3F
	LDY	#$0A
	STA	(ZBUFP+1),Y
	LDY	#$37
	LDA	#$00
	STA	(ZBUFP+1),Y
	INY
	LDA	#$7F
	STA	(ZBUFP+1),Y
	JSR	WRTVTOC
	LDA	#$00
	TAY
L0BA6	STA	FILDIR,Y
	INY
	BPL	L0BA6
	LDA	#$07
	STA	CDIRS
L0BB1	JSR	WRTDIR
	DEC	CDIRS
	BPL	L0BB1
	JSR	DELDOS
	JMP	FGREAT
LISTDIR	LDA	#$00
	STA	TEMP4
	JSR	SFDIR
	BCC	LDENT1
	BCS	LDCNT
GDCHAR	BIT	TEMP4
	BMI	LDDONE
	LDY	TEMP4
	LDA	(ZSBA),Y
	STA	SVDBYT
	INC	TEMP4
	CMP	#$9B
	BNE	GDCRTN
	CPY	#$04
	BCS	LDENT
	LDA	#$80
	STA	TEMP4
GDCRTN	JMP	GREAT
LDENT	LDA	#$00
	STA	TEMP4
	JSR	CFSDIR
	BCS	LDCNT
LDENT1	JSR	FDENT
	JMP	GREAT
LDCNT	JSR	RDVTOC
	LDY	#$04
	LDA	(ZBUFP+1),Y
	PHA
	DEY
	LDA	(ZBUFP+1),Y
	TAY
	PLA
	JSR	CVDX
	LDY	#$03
	JSR	CVDY
	LDA	#$00
	STA	TEMP4
	JMP	FGREAT
LDDONE	JMP	ERREOF
FDENT	LDY	#$00
	LDA	#$20
	STA	(ZSBA),Y
	LDX	CDIRD
	LDA	FILDIR,X
	AND	#$20
	BEQ	LD1
	LDA	#$2A
	STA	(ZSBA),Y
LD1	INY
	LDA	#$20
	STA	(ZSBA),Y
	INY
LD2	LDA	S_DOSSYS3,X
	STA	(ZSBA),Y
	INX
	INY
	CPY	#$0D
	BCC	LD2
	LDA	#$20
	STA	(ZSBA),Y
	INY
	STY	TEMP4
	LDX	CDIRD
	LDY	FILDIR+1,X
	LDA	FILDIR+2
CVDX	LDX	#$64
	JSR	CVDIGIT
	LDX	#$0A
	JSR	CVDIGIT
	TYA
	JSR	STDIGIT
	LDY	#$11
CVDY	LDA	#$9B
	STA	(ZSBA),Y
	LDY	#$00
	STY	TEMP4
	RTS
CVDIGIT	STX	TEMP3
	LDX	#$FF
CVD1	STA	TEMP2
	STY	TEMP1
	INX
	SEC
	LDA	TEMP1
	SBC	TEMP3
	TAY
	LDA	TEMP2
	SBC	#$00
	BCS	CVD1
	TXA
STDIGIT	ORA	#$30
	LDY	TEMP4
	STA	(ZSBA),Y
	INC	TEMP4
	LDA	TEMP2
	LDY	TEMP1
	RTS
FNDCODE	LDA	ICBAL,X
	STA	ZBUFP
	LDA	ICBAH,X
	STA	ZBUFP+1
	LDY	#$02
FD0A	LDA	(ZBUFP),Y
	DEY
	BMI	FNDERR
	CMP	#$3A
	BNE	FD0A
	INY
FNDCNX	LDX	#$0B
	LDA	#$20
FD0	STA	FNAME,X
	DEX
	BPL	FD0
	LDX	#$00
	STX	TEMP1
FD1	INY
	LDA	(ZBUFP),Y
	CMP	#$2A
	BNE	FD3
FD2	LDA	#$3F
	JSR	FDSCHAR
	BCC	FD2
	BPL	FD1
	BMI	FDEND
FD3	CMP	#$2E
	BNE	FD4
	BIT	TEMP1
	BMI	FDEND
	LDX	#$08
	ROR	TEMP1
	BCC	FD1
FD4	CMP	#$3F
	BEQ	FD6
	CMP	#$41
	BCC	FD5
	CMP	#$5B
	BCC	FD6
FD5	CPX	#$00
	BEQ	FNDERR
	CMP	#$30
	BCC	FDEND
	CMP	#$3A
	BCS	FDEND
FD6	JSR	FDSCHAR
	JMP	FD1
FDEND	LDX	CURFCB
	RTS
FNDERR	JMP	ERRFN
FDSCHAR	CPX	#$08
	BCC	FDSC2
	BEQ	FDSC1
	CPX	#$0C
	BCC	FDSC2
	RTS
FDSC1	BIT	TEMP1
	BMI	FDSC2
	RTS
FDSC2	STA	FNAME,X
	INX
	CLC
	RTS
SFDIR	LDA	#$FF
	STA	L1123
	STA	CDIRS
	STA	L1128
	LDA	#$70
	STA	CDIRD
CFSDIR	INC	L1128
	CLC
	LDA	CDIRD
	ADC	#$10
	BPL	L0D47
	INC	CDIRS
	LDA	#$08
	CMP	CDIRS
	BCC	L0D42
	BEQ	L0D86
L0D42	JSR	L0E9D
	LDA	#$00
L0D47	STA	CDIRD
	TAY
	LDA	FILDIR,Y
	BEQ	L0D69
	BMI	L0D69
	LDX	#$00
L0D54	LDA	FNAME,X
	CMP	#$3F
	BEQ	L0D60
	CMP	S_DOSSYS3,Y
	BNE	CFSDIR
L0D60	INX
	INY
	CPX	#$0B
	BNE	L0D54
	CLC
	BCC	L0D86
L0D69	LDA	L1123
	BPL	L0D80
	LDA	CDIRS
	STA	L1123
	LDA	CDIRD
	STA	L1124
	LDA	L1128
	STA	L1125
L0D80	LDA	FILDIR,Y
	BMI	CFSDIR
	SEC
L0D86	LDX	CURFCB
	RTS
WRTNXS	LDA	FCBFLG,X
	BMI	WRTN1
	ASL	A
	BPL	WRU1
	ASL	A
	STA	FCBFLG,X
	JSR	WRCSIO
	BMI	WRNERR
WRU1	JMP	RDNXTS
WRTN1	JSR	GETSECTOR
	LDA	FCBCNT,X
	AND	#$7F
L0DA6	LDY	#$7F
	STA	(ZSBA),Y
	LDA	#$02
	STA	TEMP3
L0DAF	LDA	FCBLSN+1,X
	ORA	FCBFNO,X
	LDY	#$7D
	STA	(ZSBA),Y
	INY
	LDA	FCBLSN,X
	STA	(ZSBA),Y
	JSR	WRCSIO
	BPL	L0DE6
	DEC	TEMP3
	BPL	L0DDD
WRNERR	LDA	DSTATS
	STA	TEMP4
	JSR	L09C3
	LDA	#$00
	STA	FCBOTC,X
	LDA	TEMP4
	JMP	RETURN
L0DDD	JSR	L0E45
	JSR	GETSECTOR
	JMP	L0DAF
L0DE6	LDA	TEMP3
	CMP	#$02
	BEQ	L0E05
	CLC
	JSR	L0E28
	LDY	#$7D
	LDA	FCBCSN+1,X
	ORA	FCBFNO,X
	STA	(ZSBA),Y
	INY
	LDA	FCBCSN,X
	STA	(ZSBA),Y
	SEC
	JSR	L0E28
L0E05	LDA	FCBCSN,X
	STA	FCBSSN,X
	LDA	FCBCSN+1,X
	STA	FCBSSN+1,X
	INC	FCBCNT,X
	BNE	L0E19
	INC	FCBCNT+1,X
L0E19	JSR	L0E45
	LDA	#$00
	STA	FCBLSN,X
	STA	FCBLSN+1,X
	STA	FCBDLN,X
	RTS
L0E28	LDY	FCBSSN,X
	LDA	FCBSSN+1,X
	BNE	L0E35
	LDY	FCBSSN,X
	BEQ	WRNERR
L0E35	JSR	L1010
	BMI	WRNERR
	RTS
WRCSIO	SEC
L0E3C	LDA	FCBCSN+1,X
	LDY	FCBCSN,X
	JMP	L1010
L0E45	LDA	FCBLSN,X
	STA	FCBCSN,X
	LDA	FCBLSN+1,X
	STA	FCBCSN+1,X
	RTS
RDNXTS	LDY	#$7F
	LDA	(ZSBA),Y
	BPL	L0E5A
	SEC
	RTS
L0E5A	JSR	L0E45
	CLC
	JSR	L0E3C
	BMI	L0E8E
	LDY	#$7D
	LDA	(ZSBA),Y
	AND	#$FC
	CMP	FCBFNO,X
	BNE	L0E91
	LDA	(ZSBA),Y
	AND	#$03
	STA	FCBLSN+1,X
	INY
	LDA	(ZSBA),Y
	STA	FCBLSN,X
	INY
	LDA	(ZSBA),Y
	BMI	L0E82
	LDA	#$7D
L0E82	AND	#$7F
	STA	FCBMLN,X
	LDA	#$00
	STA	FCBDLN,X
	CLC
	RTS
L0E8E	JSR	ERRIO
L0E91	LDA	ICCOM,X
	CMP	#$21
	BEQ	L0E9B
	JSR	ERFNMM
L0E9B	SEC
	RTS
L0E9D	CLC
	BCC	DIRIO
WRTDIR	SEC
DIRIO	PHP
	LDA	#$11
	STA	DBUFHI
	LDA	#$E0
	STA	DBUFLO
	CLC
	LDA	CDIRS
	ADC	#$69
	TAY
	LDA	#$01
	ADC	#$00
	JMP	L0EDC
RDVTOC	LDY	#$05
	LDA	(ZBUFP+1),Y
	BEQ	RDVGO
	JSR	WRTVTOC
RDVGO	CLC
	BCC	DSYSIO
WRTVTOC	LDY	#$05
	LDA	#$00
	STA	(ZBUFP+1),Y
	SEC
DSYSIO	PHP
	LDA	$46
	STA	DBUFHI
	LDA	ZBUFP+1
	STA	DBUFLO
	LDY	#$68
	LDA	#$01
L0EDC	PLP
L0EDD	JSR	BSIO
	BMI	DSIOER
	RTS
DSIOER	CMP	#$83
	BEQ	DEAD
	JMP	ERRIO
DEAD	JMP	ERRSYS
L0EED	LDA	#$00
	LDY	#$03
L0EF1	LSR	FCBCSN+1,X
	ROR	FCBCSN,X
	ROR	A
	DEY
	BNE	L0EF1
	LDY	#$05
L0EFD	ROR	A
	DEY
	BNE	L0EFD
	TAY
	LDA	#$00
	SEC
L0F05	ROR	A
	DEY
	BPL	L0F05
	PHA
	LDA	FCBCSN,X
	ADC	#$0A
	TAY
	PLA
	ORA	(ZBUFP+1),Y
	STA	(ZBUFP+1),Y
	LDY	#$03
	LDA	(ZBUFP+1),Y
	CLC
	ADC	#$01
	STA	(ZBUFP+1),Y
	INY
	LDA	(ZBUFP+1),Y
	ADC	#$00
	STA	(ZBUFP+1),Y
	INY
	LDA	#$FF
	STA	(ZBUFP+1),Y
	RTS
GETSECTOR	LDY	#$09
GS1	INY
	CPY	#$64
	BCS	GSERR
	LDA	(ZBUFP+1),Y
	BEQ	GS1
	STY	TEMP1
	PHA
	SEC
	LDY	#$03
	LDA	(ZBUFP+1),Y
	SBC	#$01
	STA	(ZBUFP+1),Y
	INY
	LDA	(ZBUFP+1),Y
	SBC	#$00
	STA	(ZBUFP+1),Y
	INY
	LDA	#$FF
	STA	(ZBUFP+1),Y
	PLA
	LDY	#$FF
GS2	INY
	ASL	A
	BCC	GS2
	STY	TEMP2
GS3	LSR	A
	DEY
	BPL	GS3
	LDY	TEMP1
	STA	(ZBUFP+1),Y
	SEC
	LDA	TEMP1
	SBC	#$0A
	LDY	#$00
	STY	TEMP1
GS4	ASL	A
	ROL	TEMP1
	INY
	CPY	#$03
	BCC	GS4
	CLC
	ADC	TEMP2
	STA	FCBLSN,X
	LDA	TEMP1
	ADC	#$00
	STA	FCBLSN+1,X
	RTS
GSERR	JMP	ERRNSA
SETUP	LDA	#$9F
	STA	ERRNO
	STX	CURFCB
	TSX
	INX
	INX
	STX	ENTSTK
	LDX	CURFCB
	LDA	ICDNO,X
	LDA	ICDNOZ
	STA	DUNIT
	JSR	L0FA7
	JMP	L103B
L0FA7	LDY	DUNIT
	CPY	#$08
	BCC	L0FB0
	BNE	DERR1
L0FB0	DEY
	LDA	DRVTBL,Y
	TAY
L0FB5	BMI	DERR1
	LDA	#$00
	JSR	L0FD4
	STA	$46
	STY	ZBUFP+1
	RTS
DERR1	JMP	ERRDNO
L0FC4	LDY	FCBBUF,X
	DEY
	TYA
	LDY	L1157
	JSR	L0FD4
	STA	ZSBA+1
	STY	ZSBA
	RTS
L0FD4	STY	TEMP1
	LDY	#$00
	STY	TEMP2
	CLC
	LDY	SAFBFW
	BPL	L0FE3
	SEC
L0FE3	ADC	TEMP1
	LSR	A
	ROR	TEMP2
	STA	TEMP1
	BIT	SAFBFW
	BMI	L1001
	CLC
	LDA	SASA
	ADC	TEMP2
	TAY
	LDA	SASA+1
	ADC	TEMP1
	RTS
L1001	SEC
	LDA	SASA
	SBC	TEMP2
	TAY
	LDA	SASA+1
	SBC	TEMP1
	RTS
L1010	STA	DCBSEC+1
	STY	DCBSEC
	LDA	#$52
	BCC	L101C
	LDA	#$57
L101C	STA	DCBCMD
	LDA	ZSBA
	STA	DBUFLO
	LDA	ZSBA+1
	STA	DBUFHI
	LDY	#$02
L102B	TYA
	PHA
	JSR	L0772
	PLA
	TAY
	LDA	DSTATS
	BPL	L103A
	DEY
	BPL	L102B
L103A	RTS
L103B	LDA	FCBBUF,X
	BNE	L1058
	LDY	#$07
L1042	LDA	SECTBL,Y
	BEQ	L104D
	DEY
	BPL	L1042
	JMP	ERRNSB
L104D	INY
	TYA
	STA	FCBBUF,X
	LDA	#$80
	DEY
	STA	SECTBL,Y
L1058	JMP	L0FC4
FRESBUF	LDY	FCBBUF,X
	BEQ	FSBR
	DEY
	LDA	#$00
	STA	SECTBL,Y
	STA	FCBBUF,X
FSBR	RTS
WRTDOS	LDY	FCBCSN,X
	LDA	FCBCSN+1,X
	JSR	SETDSO
	JSR	WD0
	JMP	GREAT
DELDOS	LDA	#$00
DD1	STA	DFSFLG
	LDA	#$07
	STA	DBUFHI
	LDA	#$00
	STA	DBUFLO
	LDA	#$00
	TAY
	INY
	SEC
	JMP	L0EDD
SETDSO	STY	DFLINK
	STA	DFLINK+1
	LDA	#$FF
	BNE	DD1
WD0	LDA	#$07
	STA	ZBUFP+1
	LDA	#$80
	STA	ZBUFP
WD1	LDY	#$00
WD2	LDA	(ZBUFP),Y
	STA	(ZSBA),Y
	INY
	CPY	#$7D
	BCC	WD2
	TYA
	STA	FCBDLN,X
	JSR	INCBA
	CMP	SASA+1
	BCC	WD3
	BNE	WD4
	LDA	ZBUFP
	CMP	SASA
	BCC	WD3
	BNE	WD4
WD3	JSR	WRTNXS
	JMP	WD1
WD4	RTS
TSTDOS	LDY	#$0B
TDF1	LDA	FNAME-1,Y
	CMP	DFN-1,Y
	BNE	DFN-1
	DEY
	BNE	TDF1
	RTS
DFN	.byte	"DOS     SYS "
ERRPOT	INC	ERRNO
ERFNF	INC	ERRNO
ERDFULL	INC	ERRNO
ERDVDC	INC	ERRNO
ERFLOCK	INC	ERRNO
ERRPDL	INC	ERRNO
ERRFN	INC	ERRNO
ERFNMM	INC	ERRNO
ERRSYS	INC	ERRNO
ERRNSA	INC	ERRNO
ERRNSB	INC	ERRNO
ERRDNO	INC	ERRNO
	LDA	ERRNO
RETURN	LDX	CURFCB
	STA	ICSTA,X
	LDX	ENTSTK
	TXS
	LDX	CURFCB
	TAY
	LDA	SVDBYT
	RTS
ERRIO	LDA	DSTATS
	BMI	RETURN
FGREAT	JSR	FRESBUF
GREAT	LDA	#$01
	BNE	RETURN
ERREOF	LDA	#$88
	BMI	RETURN
ENTSTK	.byte	$F7
CURFCB	.byte	$10
L1123	.byte	$00
L1124	.byte	$00
L1125	.byte	$00
CDIRD	.byte	$00
CDIRS	.byte	$00
L1128	.byte	$00
SVDBYT	.byte	$9B ; '›'
TEMP1	.byte	$00
TEMP2	.byte	$05
TEMP3	.byte	$02
TEMP4	.byte	$80
DRVTBL	.byte	$03
	.byte	$02
	.byte	$01
	.byte	$00
	.byte	$FF
	.byte	$FF
	.byte	$FF
	.byte	$FF
	.byte	$FF
SECTBL	.byte	$00
	.byte	$00
	.byte	$80
	.byte	$FF
	.byte	$FF
	.byte	$FF
	.byte	$FF
	.byte	$FF
FNAME	.byte	"DOS     SYS "
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$04
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
L1157	.byte	$04
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
FCBFNO	.byte	$00
FCBOTC	.byte	$00
FCBSPR	.byte	$00
FCBSLT	.byte	$00
FCBFLG	.byte	$00
FCBMLN	.byte	$00
FCBDLN	.byte	$00
FCBBUF	.byte	$00
FCBCSN	.word	$0000
FCBLSN	.word	$0000
FCBSSN	.word	$0000
FCBCNT	.word	$0000
FCB1	.byte	$00
	.byte	$08
	.byte	$00
	.byte	$00
	.byte	$80
	.byte	$00
	.byte	$00
	.byte	$03
	.byte	$16
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$15
	.byte	$00
	.byte	$14
	.byte	$00
FCB2	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
FCB3	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
FCB4	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
FCB5	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
FCB6	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
FCB7	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
FILDIR	.byte	$40 ; '@'
	.byte	$00
	.byte	$00
	.byte	$02
	.byte	$00
	.byte	$44 ; 'D'
	.byte	$4F ; 'O'
	.byte	$53 ; 'S'
	.byte	$20 ; ' '
	.byte	$20 ; ' '
	.byte	$20 ; ' '
	.byte	$20 ; ' '
	.byte	$20 ; ' '
	.byte	$53 ; 'S'
	.byte	$59 ; 'Y'
	.byte	$53 ; 'S'
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$01
	.byte	$C5
	.byte	$02
	.byte	$AC
	.byte	$02
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$7F
	.byte	$FF
	.byte	$FF
	.byte	$FF
	.byte	$FF
	.byte	$9F
	.byte	$FF
	.byte	$FF
	.byte	$FF
	.byte	$FF
	.byte	$FF
	.byte	$FF
	.byte	$FF
	.byte	$FF
	.byte	$FF
	.byte	$FF
	.byte	$FF
	.byte	$FF
	.byte	$FF
	.byte	$FF
	.byte	$FF
	.byte	$FF
	.byte	$FF
	.byte	$FF
	.byte	$FF
	.byte	$FF
	.byte	$FF
	.byte	$FF
	.byte	$FF
	.byte	$FF
	.byte	$FF
	.byte	$FF
	.byte	$FF
	.byte	$FF
	.byte	$FF
	.byte	$FF
	.byte	$FF
	.byte	$FF
	.byte	$FF
	.byte	$FF
	.byte	$FF
	.byte	$FF
	.byte	$00
	.byte	$7F
	.byte	$FF
	.byte	$FF
	.byte	$FF
	.byte	$FF
	.byte	$FF
	.byte	$FF
	.byte	$FF
	.byte	$FF
	.byte	$FF
	.byte	$FF
	.byte	$FF
	.byte	$FF
	.byte	$FF
	.byte	$FF
	.byte	$FF
	.byte	$FF
	.byte	$FF
	.byte	$FF
	.byte	$FF
	.byte	$FF
	.byte	$FF
	.byte	$FF
	.byte	$FF
	.byte	$FF
	.byte	$FF
	.byte	$FF
	.byte	$FF
	.byte	$FF
	.byte	$FF
	.byte	$FF
	.byte	$FF
	.byte	$FF
	.byte	$FF
	.byte	$FF
	.byte	$00
	.byte	$00
	.byte	$FD
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
